# 标题：为 deepin 引入 electron 运行时软件包及应用维护提案

- 提案发起时间：2025-02-12
- 提案拉取请求：https://github.com/deepin-community/rfcs/pull/13

## 概要

本提案旨在为 deepin 引入 electron 运行时软件包，并规范基于 electron 的应用程序的打包和维护方式。考虑到 electron 在跨平台桌面应用开发中的广泛应用，以及 deepin 应用生态的扩展需求，本提案建议开始打包 electron 运行时，并建立相应的维护流程，以支持更多 electron 应用在 deepin 平台上的运行和分发。

## 动机

目前，deepin 官方仓库未提供 electron 运行时软件包，debian 社区也没有打包 electron 运行时。这意味着，依赖 electron 运行的应用程序如果要在 deepin 上发布，通常需要自行捆绑 electron 运行时，或者要求用户自行安装，这会带来以下问题：

1. **软件包体积增大：** 每个 electron 应用都捆绑 electron 运行时，导致软件包体积显著增加，浪费存储空间和带宽。
2. **重复劳动和维护成本增加：** 每个 electron 应用维护者都需要关注 electron 运行时的打包和更新，造成重复劳动。
3. **安全更新不及时：** 分散维护 electron 运行时不利于统一安全更新，可能导致安全风险。
4. **用户体验不佳：** 用户可能需要为不同的 electron 应用手动安装多个不同版本的 electron 运行时，造成混乱和资源浪费。

**本提案旨在解决上述问题，通过为 deepin 引入 electron 运行时软件包，实现以下目标：**

- **减小软件包体积：** electron 应用可以依赖系统提供的 electron 运行时，无需重复捆绑，减小软件包体积。
- **提高维护效率，降低维护成本：** deepin 社区可以集中维护 electron 运行时软件包，统一进行安全更新和维护，提高效率。
- **提升用户体验：** 用户只需安装一次 electron 运行时，即可运行多个 electron 应用，减少资源占用，提升用户体验。
- **扩展 deepin 应用生态：** 为 electron 应用提供更好的支持，吸引更多 electron 应用开发者加入 deepin 生态。

## **详细设计**

### 1. electron 运行时软件包命名和版本管理

- **软件包命名格式：** `electron-<major_version>`，例如 `electron-25`、`electron-26`、`electron-27`。 每个软件包对应 electron 官方发布的特定主版本。
- **版本号确定：**
  - **跟随上游 electron 官方发布版本：** 软件包版本号与 upstream electron 官方版本号保持一致。
  - **默认 electron 版本：** 不设置默认 electron 版本。 应用程序需要明确声明依赖的 electron 版本。避免使用 `electron` 这种通用的 metapackage，以防止默认版本升级可能导致的应用兼容性问题。
- **包共存：** 允许系统中同时安装多个不同主版本的 electron 运行时软件包，例如 `electron-25` 和 `electron-26` 可以同时安装。

### 2. electron 运行时软件包的依赖和内容

- **核心运行时文件：** 包含 electron 运行所需的必要二进制文件、库文件和资源文件。
- **依赖不包含 nodejs 库：** 由于不同版本的 electron 运行时依赖的 nodejs 库各不相同，本提案不涉及引入 nodejs 库的软件包依赖，electron 运行时将使用单独的一套 nodejs 依赖库构建，构建好的软件包 **不包含** nodejs 或 npm 相关的依赖。electron 运行时自带的环境已经足够 electron 应用使用。具体方式可参考 revyos 的 [debian-electron 项目](https://github.com/revyos/debian-electron)，已在 deepin-ports 附加仓库中实装。

### 3. electron 应用程序打包方式

- **依赖声明：** 基于 electron 的应用程序在打包时，需要在 `debian/control` 文件中明确声明依赖的 electron 运行时软件包。

  - **依赖特定 electron 版本:** `Depends: electron-25` (例如，如果应用需要 electron 25 版本) 或 `Depends: electron-26`, `Depends: electron-27` 等。
  - **不依赖通用 electron 包：** 应用程序 **不应该** 依赖类似 `electron` 这样的通用 metapackage。 必须明确指定依赖的 electron 主版本，以确保应用运行环境的稳定性。

- **应用程序打包流程：** electron 应用程序打包流程应保持现有方式，开发者需要将应用程序代码和资源打包成 debian 软件包。 但 **不再需要** 捆绑 electron 运行时。 应用程序在运行时将使用系统提供的 electron 运行时环境。

### 4. 构建和发布流程

- **源码获取：** electron 运行时源码从官方网站下载。
- **CI/CD 流程：**
  - **自动化构建：** 配置 CI/CD 流程，自动从源码构建 Debian 软件包（`.deb` 文件、`dsc`、`orig.tar.gz` 等）。
  - **OBS 构建和检查：** 自动化上传构建文件到 OBS (Open Build Service) 中进行构建。检查构建是否通过。
  - **自动提交：** PR 合并后，CI/CD 流程自动将构建好的软件包提交到对应的 deepin 组件仓库 (main 或 community)。

### 5. 版本更新和维护

#### a. 版本跟踪与发布周期

- **紧跟上游稳定版本：** deepin 社区将密切关注上游 electron 官方发布的稳定版本。一旦官方发布新的稳定版本 (通常是主版本更新)，deepin 社区将评估新版本的引入。
- **评估周期与发布时间：** 从上游发布新版本到 deepin 仓库提供更新后的 electron 软件包，将设置合理的评估和发布周期。
- **发布频率：** electron 运行时软件包的更新频率将根据上游发布节奏和 deepin 社区的评估结果而定，目标是及时提供最新的稳定版本和安全更新。

#### b. 安全更新策略

- **优先处理安全漏洞：** 安全是 electron 运行时软件包维护的最高优先级。 deepin 社区将密切关注上游 electron 官方发布的安全公告和漏洞修复。
- **快速响应机制：** 一旦上游发布安全更新，deepin 社区将立即启动快速响应机制，进行安全更新的打包、测试和发布，以最大程度地减少安全风险暴露时间。
- **邮件列表或公告通知：** electron 运行时软件包的安全更新发布信息将通过 deepin 社区的邮件列表、论坛或公告等渠道及时通知用户和开发者。

#### c. 长期支持 (LTS) 版本考量

- **评估 LTS 需求：** deepin 社区将根据实际应用生态的需求，评估是否需要长期维护特定版本的 electron 运行时作为 LTS 版本。
- **LTS 版本选择 (如果需要)：** 如果决定维护 LTS 版本，将选择上游 electron 官方提供的 LTS 版本，或者根据 deepin 应用生态的实际情况选择一个稳定且广泛使用的版本作为 LTS 版本。
- **LTS 版本维护周期：** 如果维护 LTS 版本，将明确 LTS 版本的维护周期，包括安全更新和关键 bug 修复的持续时间。
- **非 LTS 版本维护：** 对于非 LTS 版本，将根据上游更新节奏和社区资源情况进行维护，可能会在一定时间后停止维护，建议用户和开发者迁移到更新的版本或 LTS 版本。

#### d. 版本兼容性与应用迁移

- **兼容性测试：** 在发布新的 electron 运行时软件包之前，deepin 社区将进行必要的兼容性测试，尽可能减少新版本对现有 electron 应用的影响。
- **开发者沟通与文档：** 对于可能存在的兼容性问题，deepin 社区将积极与 electron 应用开发者进行沟通，提供必要的迁移指南和技术支持。
- **版本迁移建议：** 当某个 electron 运行时版本停止维护或不再推荐使用时，deepin 社区将向开发者提供明确的版本迁移建议。
- **多版本共存优势：** 由于本提案建议允许系统中同时安装多个 electron 运行时版本，应用程序可以根据自身需求选择合适的 electron 版本依赖，并在需要时逐步迁移到更新的版本，从而降低版本升级带来的兼容性风险。

## 提案弊端

- **初期需要投入资源：** 需要投入一定的资源来建立 electron 运行时软件包的构建流程，并进行测试和维护。
- **应用程序开发者需要适应新的依赖方式：** electron 应用程序开发者需要修改打包配置，声明对 electron 运行时软件包的依赖。
- **版本选择和维护策略需要社区讨论：** 需要社区讨论和决定需要维护哪些 electron 版本，以及版本更新和维护策略。

## 遗留问题

- **如何处理 electron 运行时的安全更新？** 需要建立快速响应机制，及时跟踪上游安全更新，并快速发布更新后的 electron 运行时软件包。
- **如何处理不同 electron 版本之间的兼容性问题？** 需要进行充分的测试和兼容性评估，并提供清晰的文档和指南，帮助开发者选择合适的 electron 版本。

## 替代方案

- **暂无：** 目前没有想到更优的替代方案能够在解决上述问题的同时，兼顾软件包体积、维护效率和用户体验。 如果继续沿用 electron 应用自行捆绑运行时的方案，将难以应对未来 deepin 应用生态扩展和维护复杂性提高的挑战。

## 总结

本提案建议 deepin 社区开始打包和维护 electron 运行时软件包，为 deepin 引入 electron 应用支持。 通过提供独立的 electron 运行时软件包，可以有效减小 electron 应用的体积，提高维护效率，并提升用户体验，为 deepin 应用生态的扩展奠定基础。

**下一步行动：**

1. 成立 RFC 评审小组，对本提案进行评审。
2. 社区成员对本提案进行讨论和反馈。
3. 根据评审结果和社区反馈，修改和完善提案。
4. 如果提案获得通过，开始实施 electron 运行时软件包的打包和 CI/CD 流程的开发。

请社区成员积极参与讨论，共同完善本提案，为 deepin 社区的 electron 应用生态建设贡献力量！
