# deepin 软件包patch维护约定

## 概述

目前deepin对于第一方（来自于我们主动维护的）patch，需要进行管理，以提高其可维护性和规范代码行为，避免后续出现问题。

## 1. 第一方patch定义

第一方patch 指的是此patch不存在任何上游，仅是研发在工作中发现其功能有问题或不满足要求产生的代码修补。如果patch来自于上游提交或者来自其他发行版软件包维护者的提交，即使patch是由我们研发提出也不作为第一方patch。

## 2. 第一方patch维护策略

对于第一方的patch，主要策略为：**能上游就上游**，不能被上游化的patch，需要遵循**影响最小原则**：

### 2.1 功能扩展类patch

patch是对于原有软件包的功能进行扩展的，即主要服务对象是DDE以及我们的自研应用的：

1. DDE 以及自研应用需要提供无此patch的fallback方案
2. 此patch不得影响原有软件包的功能提供

### 2.2 功能修复类patch

patch是对于原有软件包的功能进行修复的，即因为某些原因，软件包的功能不正常的：

1. 修复后的patch尽可能地避免原有软件包的功能缺失

## 3. 第一方patch的要求

对于第一方patch要求格式遵循：

### 3.1 文件格式要求

1. 以patch文件或者diff文件维护，不加以限制，但是要求与上游项目保持基本格式统一：
   - 上游只使用`.patch`文件，我们也只能使用patch文件
   - 上游使用diff文件，我们也只能使用diff文件
   - 上游patch、diff都有的时候，我们就不加以限制

### 3.2 命名和应用顺序

2. 第一方patch格式要求以`0001-xxxx`数字开头，从小到大依次应用，当中间有patch被移除后，需要将我们的第一方patch进行刷新。
   - 如果上游有存在以数字开头的patch，则第一方patch需要加在上游文件编号末尾，空余10个编号
   - 第一方patch中需要留存维护者信息和对于patch的解释
   - 有issue或者pr的需要提供指向的链接
   - **禁止提供外网不可访问的链接**（如pms链接）
   - **例外**：可以记录pms单号，但是需要保证你提供的信息已经足以说明patch的目的